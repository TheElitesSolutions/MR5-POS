# Admin User Creation Scripts

This directory contains scripts to create a default admin user for the MR5 POS application.

## Default Credentials

- **Username:** `admin`
- **Password:** `admin`
- **Role:** `ADMIN`
- **Email:** `admin@mr5pos.com`

⚠️ **Important:** Please change the password after first login!

## Methods to Create Admin User

### Method 1: Automatic Creation (Recommended)

The application automatically creates the admin user on startup if it doesn't exist.

Simply start the application:
```bash
yarn dev
```

The admin user will be created automatically when the app initializes.

**Check the console logs** for detailed information about the creation process. Look for messages starting with `[CreateAdminUser]`.

### Method 1b: Manual Trigger via IPC (If Automatic Fails)

If automatic creation fails, you can manually trigger it from the app:

1. Start the application: `yarn dev`
2. Open Developer Tools (Press `F12` or `Ctrl+Shift+I`)
3. Go to the Console tab
4. Run this command:
   ```javascript
   window.ipc.invoke('mr5pos:auth:create-default-admin')
     .then(result => console.log('Admin creation result:', result))
     .catch(error => console.error('Failed:', error));
   ```

This will attempt to create the admin user and show the result in the console.

### Method 2: Manual SQL Execution

1. **Generate SQL commands:**
   ```bash
   node scripts/insert-admin-raw.js
   ```

2. **Execute the SQL:**
   - Open `scripts/admin-user-sql.txt`
   - Copy the appropriate SQL command (INSERT for new user, UPDATE for existing)
   - Execute it using:
     - [DB Browser for SQLite](https://sqlitebrowser.org/) (Recommended)
     - Any SQLite client
     - Command line SQLite tools

3. **Database Location:**
   ```
   Windows: C:\Users\<YourUsername>\AppData\Roaming\my-nextron-app\mr5-pos.db
   macOS: ~/Library/Application Support/my-nextron-app/mr5-pos.db
   Linux: ~/.config/my-nextron-app/mr5-pos.db
   ```

### Method 3: PowerShell Script (Windows)

Run the PowerShell script which provides instructions:
```powershell
.\scripts\create-admin.ps1
```

## Files in This Directory

- **`insert-admin-raw.js`** - Generates SQL commands for creating admin user
- **`create-admin.ps1`** - PowerShell script with instructions (Windows)
- **`admin-user-sql.txt`** - Generated SQL commands (created after running insert-admin-raw.js)
- **`README.md`** - This file

## Code Implementation

The automatic admin user creation is implemented in:
- `main/utils/create-default-admin.ts` - Contains the `ensureDefaultAdminExists()` function
- `main/background.ts` - Calls the function during app initialization (line 62)

## Troubleshooting

### Admin User Already Exists

If the admin user already exists, you can update the password using the UPDATE SQL command generated by `insert-admin-raw.js`.

### Database Not Found

Make sure the application has been run at least once to create the database. Run:
```bash
yarn dev
```

### Login Issues

If you cannot login with `admin`/`admin`:
1. Verify the user exists by checking the database
2. Regenerate the SQL and update the password
3. Check that `isActive` is set to `1` in the database

## Security Notes

- The default password is intentionally simple for initial setup
- **Always change the default password after first login**
- Passwords are hashed using bcryptjs with 10 salt rounds
- The password hash is stored securely in the database
